# hajimu_engine_3d

> **はじむ言語**向け SDL2 + OpenGL 3.3 Core Profile 3D レンダリングエンジン

メッシュプリミティブ生成・OBJ ロード・Blinn-Phong 照明・テクスチャ・カメラを統合した  
3D ゲーム/可視化アプリ向けプラグインです。

---

## 機能

| カテゴリ | 内容 |
|---|---|
| ウィンドウ | OpenGL 3.3 Core Profile ウィンドウ作成・更新 |
| カメラ | 位置・注視点・FOV・ニア/ファー平面設定 |
| メッシュ | キューブ / 球 / 平面プリミティブ + OBJ ファイル読込 |
| マテリアル | ベースカラー・テクスチャ貼り付け・スペキュラー設定 |
| テクスチャ | PNG / JPG / BMP 読込 (stb_image) |
| 照明 | 環境光 / 方向ライト / ポイントライト (最大 4 個) |
| 描画 | TRS (位置・回転・スケール) 変換付きメッシュ描画 |
| 入力 | キーボード / マウス位置・Delta・ボタン |
| 時間 | デルタ時間 / FPS |

## 依存ライブラリ

| ライブラリ | 用途 | 入手方法 |
|---|---|---|
| SDL2 | ウィンドウ / 入力 / GL コンテキスト | `brew install sdl2` |
| OpenGL 3.3 | GPU 描画 | macOS / Linux 標準 |
| stb_image | テクスチャ読込 | `make vendor` で自動取得 |

---

## インストール

### ✅ 推奨: はじむパッケージマネージャー

```bash
hajimu パッケージ 追加 ReoShiozawa/hajimu_engine_3d
```

インストール後すぐに使えます:

```jp
プラグイン読込("engine_3d")
```

### ソースからビルド

```bash
# 依存ライブラリ (macOS)
brew install sdl2

# リポジトリをクローン
git clone https://github.com/ReoShiozawa/hajimu_engine_3d.git
cd hajimu_engine_3d

make          # stb_image 取得 + ビルド → build/engine_3d.hjp
make install  # → ~/.hajimu/plugins/engine_3d/
```

---

## クイックスタート

```jp
プラグイン読込("engine_3d")

3Dウィンドウ作成("はじむ 3D", 800, 600)
3Dカメラ設定(0, 3, 8,   0, 0, 0)      // 位置(eye), 注視点(target)

// メッシュ作成
箱 = 3Dキューブ作成(1, 1, 1)
床 = 3Dプレーン作成(10, 10)
3Dメッシュ色設定(箱, 0.2, 0.6, 1.0, 1.0)
3Dメッシュ色設定(床, 0.4, 0.4, 0.4, 1.0)

// ライト
3D環境光設定(0.2, 0.2, 0.2)
3D平行光設定(0.5, -1.0, 0.3,   1.0, 1.0, 0.9)

角度 = 0

ループ {
  もし(3D更新() == 偽) { 抜ける }

  角度 = 角度 + 30 * 3Dデルタ時間()

  3D描画開始(0.05, 0.05, 0.1)
    3Dメッシュ描画(箱, 0, 0.5, 0,   0, 角度, 0,   1, 1, 1)
    3Dメッシュ描画(床, 0, 0,   0,   0, 0,     0,   1, 1, 1)
  3D描画終了()
}

3Dウィンドウ削除()
```

---

## API リファレンス

### ライフサイクル

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `3Dウィンドウ作成(タイトル, 幅, 高さ)` | str, int, int | 真/偽 | OpenGL ウィンドウ生成 |
| `3Dウィンドウ削除()` | — | null | 全リソース解放 |
| `3D更新()` | — | 真/偽 | イベント処理。終了要求で偽 |
| `3Dデルタ時間()` | — | float | 前フレームからの経過秒 |
| `3DFPS()` | — | int | 直近の FPS |

### カメラ

| 関数 | 引数 | 説明 |
|---|---|---|
| `3Dカメラ設定(ex,ey,ez, tx,ty,tz)` | 6×float | eye 位置と注視点を同時設定 |
| `3Dカメラ位置(x, y, z)` | 3×float | カメラ位置のみ設定 |
| `3Dカメラ注視点(tx, ty, tz)` | 3×float | 注視点のみ設定 |
| `3D視野角設定(fov, near, far)` | 3×float | FOV(度)・クリップ距離 |

### メッシュ生成

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `3Dキューブ作成(w, h, d)` | 3×float | メッシュID | 直方体 |
| `3Dスフィア作成(r, slices, stacks)` | float, int, int | メッシュID | 球 |
| `3Dプレーン作成(w, d)` | 2×float | メッシュID | XZ 平面 |
| `3DOBJ読込(パス)` | str | メッシュID | .obj ファイル読込 |
| `3Dメッシュ削除(id)` | int | null | メッシュ解放 |
| `3Dメッシュ頂点数(id)` | int | int | 頂点数取得 |

### マテリアル / テクスチャ

| 関数 | 引数 | 説明 |
|---|---|---|
| `3Dメッシュ色設定(id, r, g, b, a)` | int, 4×float | ベースカラー (0.0〜1.0) |
| `3Dメッシュテクスチャ(mesh_id, tex_id)` | 2×int | テクスチャを貼り付け。0で解除 |
| `3Dスペキュラー設定(id, 強度, 鋭さ)` | int, 2×float | スペキュラー反射の強さ・鋭さ |
| `3Dテクスチャ読込(パス)` | str | テクスチャID | PNG/JPG/BMP |
| `3Dテクスチャ削除(id)` | int | null | テクスチャ解放 |

### 照明

| 関数 | 引数 | 説明 |
|---|---|---|
| `3D環境光設定(r, g, b)` | 3×float | 全体の環境光 (0.0〜1.0) |
| `3D平行光設定(dx,dy,dz, r,g,b)` | 6×float | 方向ライト (方向ベクトル + 色) |
| `3Dポイントライト(slot, x,y,z, r,g,b, radius)` | int, 7×float | 点光源 (slot=0〜3, radius=0で無効) |

### 描画

| 関数 | 引数 | 説明 |
|---|---|---|
| `3D描画開始(r, g, b)` | 3×float | フレーム開始・バッファクリア色 |
| `3Dメッシュ描画(id, px,py,pz, rx,ry,rz, sx,sy,sz)` | int, 9×float | メッシュ描画 (位置・回転(度)・スケール) |
| `3D描画終了()` | — | フレーム終了・スワップ |

### 入力

| 関数 | 引数 | 戻り値 | 説明 |
|---|---|---|---|
| `3Dキー押下中(キー名)` | str | 真/偽 | キーが押されている間 |
| `3Dマウス X()` | — | float | マウス X 座標 |
| `3Dマウス Y()` | — | float | マウス Y 座標 |
| `3Dマウス DX()` | — | float | マウス X 移動量 |
| `3Dマウス DY()` | — | float | マウス Y 移動量 |
| `3Dマウスボタン(番号)` | int | 真/偽 | 1=左, 2=中, 3=右 |

キー名: `"w"` `"a"` `"s"` `"d"` `"q"` `"e"` `"上"` `"下"` `"左"` `"右"` `"スペース"` `"0"`〜`"9"` など

---

## 使用例

### OBJ モデル + テクスチャ

```jp
プラグイン読込("engine_3d")

3Dウィンドウ作成("モデルビューア", 1280, 720)
3Dカメラ設定(0, 2, 5,  0, 0, 0)
3D環境光設定(0.15, 0.15, 0.15)
3D平行光設定(0.3, -1.0, 0.5,  1.0, 0.95, 0.85)

モデル = 3DOBJ読込("model.obj")
テクスチャ = 3Dテクスチャ読込("texture.png")
3Dメッシュテクスチャ(モデル, テクスチャ)

ループ {
  もし(3D更新() == 偽) { 抜ける }
  3D描画開始(0.1, 0.1, 0.15)
  3Dメッシュ描画(モデル, 0,0,0,  0,0,0,  1,1,1)
  3D描画終了()
}
3Dウィンドウ削除()
```

### フライカメラ

```jp
プラグイン読込("engine_3d")

3Dウィンドウ作成("フライカメラ", 1024, 768)

カメラX = 0.0
カメラY = 2.0
カメラZ = 5.0
ヨー   = 0.0

地面 = 3Dプレーン作成(20, 20)
箱   = 3Dキューブ作成(1, 1, 1)
3D環境光設定(0.2, 0.2, 0.2)
3D平行光設定(0.4, -1, 0.3,  1, 1, 0.9)

ループ {
  もし(3D更新() == 偽) { 抜ける }
  dt = 3Dデルタ時間()
  速度 = 5.0 * dt

  ヨー = ヨー - 3Dマウス DX() * 0.2

  もし(3Dキー押下中("w")) {
    カメラX = カメラX + 数学sin(ヨー * 3.14159 / 180) * 速度
    カメラZ = カメラZ - 数学cos(ヨー * 3.14159 / 180) * 速度
  }
  もし(3Dキー押下中("s")) {
    カメラX = カメラX - 数学sin(ヨー * 3.14159 / 180) * 速度
    カメラZ = カメラZ + 数学cos(ヨー * 3.14159 / 180) * 速度
  }
  もし(3Dキー押下中("スペース")) { カメラY = カメラY + 速度 }
  もし(3Dキー押下中("q")) { カメラY = カメラY - 速度 }

  変換X = カメラX + 数学sin(ヨー * 3.14159 / 180) * 5
  変換Z = カメラZ - 数学cos(ヨー * 3.14159 / 180) * 5
  3Dカメラ設定(カメラX, カメラY, カメラZ,  変換X, カメラY, 変換Z)

  3D描画開始(0.05, 0.05, 0.1)
  3Dメッシュ描画(地面, 0,0,0,  0,0,0,  1,1,1)
  3Dメッシュ描画(箱,  0,0.5,0,  0,0,0,  1,1,1)
  3D描画終了()
}
3Dウィンドウ削除()
```

---

## ライセンス

[MIT License](LICENSE) — Copyright (c) 2026 Reo Shiozawa
